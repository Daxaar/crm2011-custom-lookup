<public:component lightweight="true">
<public:attach event="ondocumentready" onevent="Init()" />
<public:attach event="ondetach" onevent="CleanUp()" />
<public:event id="readyStateCompleteEvent" name="readystatecomplete"/>
<script language="JavaScript"></script><script type="text/javascript">
var _isLoaded=false,_isDocumentReady=false,_isContentReady=false;function Init(){_isDocumentReady=true;element.document.attachEvent("onreadystatechange",FrameLoaded);FrameLoaded()}function FrameLoaded(){_isContentReady=element.document.readyState=="complete";if(_isContentReady)InitInternal()}function InitInternal(){if(!_isDocumentReady||!_isContentReady)return;_isDocumentReady=false;if(window.document.media!="print"){var form=$get("crmForm");if(form){var tab=form.GetTab(this.element);if(!IsNull(tab))Mscrm.FormUITab.addTabStateChangeHandler(tab,Function.createDelegate(this.element,tabChangedEventHandler));else Navigate()}else{var oTabBar=GetTabBar();if(IsNull(oTabBar)||IsActive(oTabBar.CurrentTabContent)||element.preload=="1")Navigate();else oTabBar.attachEvent("onchange",OnTabSwitched)}this.attachEvent("onreadystatechange",fireReadyStateComplete)}}function CleanUp(){try{var oTabBar=GetTabBar();if(typeof oTabBar!="undefined"&&!IsNull(oTabBar))oTabBar.detachEvent("onchange",OnTabSwitched)}catch(e){}}function OnTabSwitched(){if(!_isLoaded&&IsActive(event.tabContent))Navigate()}function Navigate(){_isLoaded=true;if(this.src.toLowerCase()=="/_static/blank.htm"||this.src.toLowerCase()==Mscrm.CrmUri.create("/_static/blank.htm").toString().toLowerCase())this.src=this.url}function fireReadyStateComplete(){if(this.readyState=="complete"){var oEvent=createEventObject();readyStateCompleteEvent.fire(oEvent)}}function IsActive(oTabContent){var o=element;while(!IsNull(o)&&o!=oTabContent)o=o.parentElement;return !IsNull(o)}function tabChangedEventHandler(src,oEvent){if(oEvent.get_displayState()===Xrm.TabDisplayState.expanded)Navigate()}function GetTabBar(){var oTabBar=null,oForm=window.crmForm;if(typeof oForm!="undefined"&&!IsNull(oForm))oTabBar=window.crmForm.all.crmTabBar;return oTabBar}
</script>
</public:component>
